// SPDX-License-Identifier: GPL-3.0
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
import "forge-std/console.sol";
import "../../../src/verifier/Groth16Verifier128Leaves.sol";
import "../../../src/verifier/Groth16Verifier128LeavesIC1.sol";
import "../../../src/verifier/Groth16Verifier128LeavesIC2.sol";

contract Groth16Verifier128LeavesTest is Test {
    Groth16Verifier128Leaves verifier;
    Groth16Verifier128LeavesIC1 icContract1;
    Groth16Verifier128LeavesIC2 icContract2;

    // BLS12-381 proof constants for 128 leaves
    uint256 constant pA_x_PART1 = 0x00000000000000000000000000000000076aed58b3189ab0a86591abf032f406;
    uint256 constant pA_x_PART2 = 0x3d85023cd1e1241c8c351225f94b4ab1b4a87abdd05af4d303cdff8103562d5c;
    uint256 constant pA_y_PART1 = 0x000000000000000000000000000000000cafae81f350610933c88c3ac2dfe6d9;
    uint256 constant pA_y_PART2 = 0x24ea6589895595bae03a864ac1c4a2e6d62f3f8a08d33fd19f4c8699bcf31655;

    uint256 constant pB_x0_PART1 = 0x000000000000000000000000000000000e5e674854319a6a8e4ab14c660881e1;
    uint256 constant pB_x0_PART2 = 0xc9762263b12f8661f50feb00e41de3a16708b7e37b64e2fc033cee3febcc6eb2;
    uint256 constant pB_x1_PART1 = 0x00000000000000000000000000000000085656305f6a8e4cfbb0599f71d2a269;
    uint256 constant pB_x1_PART2 = 0xb405d46a6299bf657abfb0f9b30d557b9e3df0d1f20f3c9b4f4681db41dd92a5;
    uint256 constant pB_y0_PART1 = 0x000000000000000000000000000000000ff9f7876abae6c6a37e0b2c5fd284e7;
    uint256 constant pB_y0_PART2 = 0x2a955d1e00bed62c8ed430a5226a7adcaa0f6ac4314c980568561727fe8adb03;
    uint256 constant pB_y1_PART1 = 0x000000000000000000000000000000000340304e51ee4e5eac0584008de96fed;
    uint256 constant pB_y1_PART2 = 0xc98c43ff84a1db5f46f783fa4b3986c8f1f50cf5b7a6031d6abfbdad9be9310f;

    uint256 constant pC_x_PART1 = 0x000000000000000000000000000000000ec43fc63089c2a31f37c0440cf03435;
    uint256 constant pC_x_PART2 = 0x0a3e66d477dd88c5a26193982aff587c7778640e3de2042864491b86a40f93e5;
    uint256 constant pC_y_PART1 = 0x00000000000000000000000000000000103e2efa463c48f4fa750c3285d7ddd6;
    uint256 constant pC_y_PART2 = 0xdf1fcb65adc5d4b00e1bb3af933a6e52a968c42ab962dd444023802196b51a36;

    function setUp() public {
        // Deploy IC constants contracts first
        icContract1 = new Groth16Verifier128LeavesIC1();
        icContract2 = new Groth16Verifier128LeavesIC2();
        // Deploy main verifier with IC contract addresses
        verifier = new Groth16Verifier128Leaves(address(icContract1), address(icContract2));
    }

    function testProof128() public view {
        // Proof data from proof.json
        uint256[4] memory proof_a = [pA_x_PART1, pA_x_PART2, pA_y_PART1, pA_y_PART2];

        uint256[8] memory proof_b =
            [pB_x0_PART1, pB_x0_PART2, pB_x1_PART1, pB_x1_PART2, pB_y0_PART1, pB_y0_PART2, pB_y1_PART1, pB_y1_PART2];

        uint256[4] memory proof_c = [pC_x_PART1, pC_x_PART2, pC_y_PART1, pC_y_PART2];

        // Public signals array with 257 elements from public.json
        uint256[257] memory pub_signals = [
            26975209276776476692791800104944319946909193252482610676888258047264401491067,
            6218676549690402052910318315276979534381485872621884367715834658603456243904,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            5708510646087729135889959965248975632956651064800454628727069218571497917126,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            6218676549690402052910318315276979534381485872621884367715834658603456243904,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            5708510646087729135889959965248975632956651064800454628727069218571497917126,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            6218676549690402052910318315276979534381485872621884367715834658603456243904,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            5708510646087729135889959965248975632956651064800454628727069218571497917126,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            6218676549690402052910318315276979534381485872621884367715834658603456243904,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            5708510646087729135889959965248975632956651064800454628727069218571497917126,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000
        ];

        // Verify with the proof data
        bool result = verifier.verifyProof(proof_a, proof_b, proof_c, pub_signals);

        console.log("128-leaf proof verification result:", result);
        assertTrue(result, "Proof should be valid");
    }
}
