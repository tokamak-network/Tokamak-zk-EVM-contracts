// SPDX-License-Identifier: GPL-3.0
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
import "forge-std/console.sol";
import "../../../src/verifier/Groth16Verifier64Leaves.sol";
import "../../../src/verifier/Groth16Verifier64LeavesIC.sol";

contract Groth16Verifier64LeavesNewProofTest is Test {
    Groth16Verifier64Leaves verifier;
    Groth16Verifier64LeavesIC icContract;

    // Updated BLS12-381 proof constants from new proof.json - split into PART1/PART2
    uint256 constant pA_x_PART1 = 0x000000000000000000000000000000000c2c7403abb0d7f9774667af73c84cbe;
    uint256 constant pA_x_PART2 = 0x6d615eec6620e135cf3764a2b798e37c39f3449c5c67cf1ee1adb82e1984696a;
    uint256 constant pA_y_PART1 = 0x0000000000000000000000000000000014104f1ea260fd94e9e946275fd78bee;
    uint256 constant pA_y_PART2 = 0xc85653aed170fa0c8f259a3b34a4624150a85bc817febfa3f251da31558fe519;

    //x0
    uint256 constant pB_x0_PART1 = 0x00000000000000000000000000000000052c670ce3848f29d28fc43e806e00f8;
    uint256 constant pB_x0_PART2 = 0x6294d7a1f647a55f539228dabe12a1b6e2cd53274196e66a097220327b34537f;
    //x1
    uint256 constant pB_x1_PART1 = 0x000000000000000000000000000000001260199a730516c11d484d418bdf4280;
    uint256 constant pB_x1_PART2 = 0xbc886344866cc0ec0d9bd280480f4e0c4cb717dc61832cd6f2115cd9db6bfe2d;
    //y0
    uint256 constant pB_y0_PART1 = 0x00000000000000000000000000000000154c003d4c9b7fd20b6fdbc5e9a561b0;
    uint256 constant pB_y0_PART2 = 0x8bfe6767182b7d908be77400691a3037687b62b2eac3f0734ed0e2dc20978ddb;
    //y1
    uint256 constant pB_y1_PART1 = 0x00000000000000000000000000000000108cd334783e96f5f7f0b39fedc77592;
    uint256 constant pB_y1_PART2 = 0xb1642e9ea4d6bddd02c076903c77f70d854222c53e89c83da3b4b7fc31271c5e;

    uint256 constant pC_x_PART1 = 0x000000000000000000000000000000001641171bf90e5d5fa491c2a8581c6c72;
    uint256 constant pC_x_PART2 = 0x9da24b959702f23f66531cbc4c1cb2f8316146e168997e4b56c3cf272ed3116d;
    uint256 constant pC_y_PART1 = 0x00000000000000000000000000000000068a4ddcf98e105f28eaff2b8e6143ca;
    uint256 constant pC_y_PART2 = 0xd325622716af87dee0eb2e0a1fce70b0b95f6a046e0b6fca6bb1082a6be3489f;

    function setUp() public {
        // Deploy IC constants contract first
        icContract = new Groth16Verifier64LeavesIC();
        // Deploy main verifier with IC contract address
        verifier = new Groth16Verifier64Leaves(address(icContract));
    }

    function testVerifyProof64() public view {
        // New proof data from updated proof.json
        uint256[4] memory proof_a = [pA_x_PART1, pA_x_PART2, pA_y_PART1, pA_y_PART2];

        uint256[8] memory proof_b =
            [pB_x0_PART1, pB_x0_PART2, pB_x1_PART1, pB_x1_PART2, pB_y0_PART1, pB_y0_PART2, pB_y1_PART1, pB_y1_PART2];

        uint256[4] memory proof_c = [pC_x_PART1, pC_x_PART2, pC_y_PART1, pC_y_PART2];

        // Updated public signals array with 129 elements from new public.json
        uint256[129] memory pub_signals = [
            50803289751659168012871184753748907509578899911239403202058491060091161856746,
            6218676549690402052910318315276979534381485872621884367715834658603456243904,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            5708510646087729135889959965248975632956651064800454628727069218571497917126,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            6218676549690402052910318315276979534381485872621884367715834658603456243904,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            6218676549690402052910318315276979534381485872621884367715834658603456243904,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            6218676549690402052910318315276979534381485872621884367715834658603456243904,
            6218676549690402052910318315276979534381485872621884367715834658603456243904,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            5708510646087729135889959965248975632956651064800454628727069218571497917126,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            123456789123456789123456789123456789123456789123456789123456789123456789,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000,
            2000000000000000000000000000
        ];

        // Verify with new proof data
        bool result = verifier.verifyProof(proof_a, proof_b, proof_c, pub_signals);

        console.log("New 64-leaf proof verification result:", result);
        assertTrue(result, "New proof should be valid");
    }
}
